from PyQt5 import QtCore
from PyQt5.QtWidgets import QDialog, QGridLayout, QLabel, QSpinBox, QLineEdit, QCheckBox, QDoubleSpinBox, QDialogButtonBox

import json
from current.default_config import defaults

class ExtendedBarPopup(QDialog):

    def __init__(self, parent=None, vars=None, **kw):
        super(ExtendedBarPopup, self).__init__(parent)
        self.setWindowTitle("Extended Bar Plot")
        grid = QGridLayout()
        grid.setAlignment(QtCore.Qt.AlignTop)
        self.setLayout(grid)

        self.vars = vars
        self.defaults = defaults["extended_bar_settings"]


        bar_cols_label = QLabel("Columns Per Page", self)
        bar_rows_label = QLabel("Rows Per Page", self)
        apply_status_label = QLabel("Apply Status?", self)
        meas_bar_colour_label = QLabel("Measured Bar Colour", self)
        lost_bar_colour_label = QLabel("Missing Bar Colour", self)
        unassigned_bar_colour_label = QLabel("Unassigned Bar Colour", self)
        bar_width_label = QLabel("Bar Width", self)
        bar_alpha_label = QLabel("Bar Alpha", self)
        bar_linewidth = QLabel("Bar Line Width", self)
        bar_title_y_label = QLabel("Title Y", self)
        bar_font_size_label = QLabel("Title Font Size", self)
        bar_font_label = QLabel("Title Font", self)
        bar_threshold_label = QLabel("Bar Threshold", self)
        bar_threshold_colour_label = QLabel("Bar Threshold Colour", self)
        bar_threshold_colour_lw_label = QLabel("Bar Threshold Line Width", self)
        x_tick_rotation_label = QLabel("X Tick Rotation", self)
        x_tick_font_label = QLabel("X Tick Font", self)
        x_tick_font_size_label = QLabel("X Tick Font Size", self)
        x_tick_padding_label = QLabel("X Tick Padding", self)
        y_tick_font_size_label = QLabel("Y Tick Font Size", self)
        y_grid_colour_label = QLabel("Y Grid Colour", self)
        mark_prolines_label = QLabel("Mark Prolines", self)
        proline_marker_label = QLabel("Proline Marker", self)
        user_details_label = QLabel("Mark User Details", self)

        self.layout().addWidget(bar_cols_label, 0, 0)
        self.layout().addWidget(bar_rows_label, 1, 0)
        self.layout().addWidget(apply_status_label, 2, 0)
        self.layout().addWidget(meas_bar_colour_label, 3, 0)
        self.layout().addWidget(lost_bar_colour_label, 4, 0)
        self.layout().addWidget(unassigned_bar_colour_label, 5, 0)
        self.layout().addWidget(bar_width_label, 6, 0)
        self.layout().addWidget(bar_alpha_label, 7, 0)
        self.layout().addWidget(bar_linewidth, 8, 0)
        self.layout().addWidget(bar_title_y_label, 9, 0)
        self.layout().addWidget(bar_font_size_label, 10, 0)
        self.layout().addWidget(bar_font_label, 11, 0)
        self.layout().addWidget(bar_threshold_label, 12, 0)
        self.layout().addWidget(bar_threshold_colour_label, 13, 0)
        self.layout().addWidget(bar_threshold_colour_lw_label, 14, 0)
        self.layout().addWidget(x_tick_rotation_label, 15, 0)
        self.layout().addWidget(x_tick_font_label, 16, 0)
        self.layout().addWidget(x_tick_font_size_label, 17, 0)
        self.layout().addWidget(x_tick_padding_label, 18, 0)
        self.layout().addWidget(y_tick_font_size_label, 19, 0)
        self.layout().addWidget(y_grid_colour_label, 20, 0)
        self.layout().addWidget(mark_prolines_label, 21, 0)
        self.layout().addWidget(proline_marker_label, 22, 0)
        self.layout().addWidget(user_details_label, 23, 0)

        self.bar_cols = QSpinBox()
        self.bar_rows = QSpinBox()
        self.apply_status = QCheckBox()
        self.meas_bar_colour = QLineEdit()
        self.lost_bar_colour = QLineEdit()
        self.unassigned_bar_colour = QLineEdit()
        self.bar_width = QDoubleSpinBox()
        self.bar_alpha = QSpinBox()
        self.bar_linewidth = QDoubleSpinBox()
        self.bar_title_y = QDoubleSpinBox()
        self.bar_title_font = QLineEdit()
        self.bar_title_font_size = QSpinBox()
        self.bar_threshold = QCheckBox()
        self.bar_threshold_colour = QLineEdit()
        self.bar_threshold_linewidth = QSpinBox()
        self.x_tick_rotation = QSpinBox()
        self.x_tick_font_size = QSpinBox()
        self.x_tick_font = QLineEdit()
        self.x_tick_padding = QDoubleSpinBox()
        self.y_tick_font_size = QSpinBox()
        self.y_grid_colour = QLineEdit()
        self.markProlines = QCheckBox()
        self.proline_marker = QLineEdit()
        self.user_details = QCheckBox()

        self.layout().addWidget(self.bar_cols, 0, 1)
        self.layout().addWidget(self.bar_rows, 1, 1)
        self.layout().addWidget(self.apply_status, 2, 1)
        self.layout().addWidget(self.meas_bar_colour, 3, 1)
        self.layout().addWidget(self.lost_bar_colour, 4, 1)
        self.layout().addWidget(self.unassigned_bar_colour, 5, 1)
        self.layout().addWidget(self.bar_width, 6, 1)
        self.layout().addWidget(self.bar_alpha, 7, 1)
        self.layout().addWidget(self.bar_linewidth, 8, 1)
        self.layout().addWidget(self.bar_title_y, 9, 1)
        self.layout().addWidget(self.bar_title_font_size, 10, 1)
        self.layout().addWidget(self.bar_title_font, 11, 1)
        self.layout().addWidget(self.bar_threshold, 12, 1)
        self.layout().addWidget(self.bar_threshold_colour, 13, 1)
        self.layout().addWidget(self.bar_threshold_linewidth, 14, 1)
        self.layout().addWidget(self.x_tick_rotation, 15, 1)
        self.layout().addWidget(self.x_tick_font_size, 16, 1)
        self.layout().addWidget(self.x_tick_font, 17, 1)
        self.layout().addWidget(self.x_tick_padding, 18, 1)
        self.layout().addWidget(self.y_tick_font_size, 19, 1)
        self.layout().addWidget(self.y_grid_colour, 20, 1)
        self.layout().addWidget(self.markProlines, 21, 1)
        self.layout().addWidget(self.proline_marker, 22, 1)
        self.layout().addWidget(self.user_details, 23, 1)

        self.buttonBox = QDialogButtonBox(QDialogButtonBox.Ok | QDialogButtonBox.Cancel | QDialogButtonBox.RestoreDefaults)

        self.buttonBox.accepted.connect(self.set_values)
        self.buttonBox.rejected.connect(self.reject)
        self.buttonBox.button(QDialogButtonBox.RestoreDefaults).clicked.connect(self.set_defaults)

        self.layout().addWidget(self.buttonBox, 24, 0, 1, 2)
        if vars:
            self.get_values()

    def set_defaults(self):
        self.bar_cols.setValue(self.defaults["ext_bar_cols_page"])
        self.bar_rows.setValue(self.defaults["ext_bar_rows_page"])
        self.apply_status.setChecked(self.defaults["ext_bar_apply_status_2_bar_color"])
        self.meas_bar_colour.setText(self.defaults["ext_bar_color_measured"])
        self.lost_bar_colour.setText(self.defaults["ext_bar_color_lost"])
        self.unassigned_bar_colour.setText(self.defaults["ext_bar_color_unassigned"])
        self.bar_width.setValue(self.defaults["ext_bar_bar_width"])
        self.bar_alpha.setValue(self.defaults["ext_bar_bar_alpha"])
        self.bar_linewidth.setValue(self.defaults["ext_bar_bar_linewidth"])
        self.bar_title_y.setValue(self.defaults["ext_bar_title_y"])
        self.bar_title_font.setText(self.defaults["ext_bar_title_fn"])
        self.bar_title_font_size.setValue(self.defaults["ext_bar_title_fs"])
        self.bar_threshold.setChecked(self.defaults["ext_bar_plot_threshold"])
        self.bar_threshold_colour.setText(self.defaults["ext_bar_plot_threshold_color"])
        self.bar_threshold_linewidth.setValue(self.defaults["ext_bar_plot_threshold_lw"])
        self.x_tick_rotation.setValue(self.defaults["ext_bar_x_ticks_rot"])
        self.x_tick_font_size.setValue(self.defaults["ext_bar_y_label_fs"])
        self.x_tick_font.setText(self.defaults["ext_bar_x_ticks_fn"])
        self.x_tick_padding.setValue(self.defaults["ext_bar_x_ticks_pad"])
        self.y_tick_font_size.setValue(self.defaults["ext_bar_y_ticks_fs"])
        self.y_grid_colour.setText(self.defaults["ext_bar_y_grid_color"])
        self.markProlines.setChecked(self.defaults["ext_bar_mark_prolines"])
        self.proline_marker.setText(self.defaults["ext_bar_proline_mark"])
        self.user_details.setChecked(self.defaults["ext_bar_mark_user_details"])

    def get_values(self):
        self.bar_cols.setValue(self.vars["ext_bar_cols_page"])
        self.bar_rows.setValue(self.vars["ext_bar_rows_page"])
        self.apply_status.setChecked(self.vars["ext_bar_apply_status_2_bar_color"])
        self.meas_bar_colour.setText(self.vars["ext_bar_color_measured"])
        self.lost_bar_colour.setText(self.vars["ext_bar_color_lost"])
        self.unassigned_bar_colour.setText(self.vars["ext_bar_color_unassigned"])
        self.bar_width.setValue(self.vars["ext_bar_bar_width"])
        self.bar_alpha.setValue(self.vars["ext_bar_bar_alpha"])
        self.bar_linewidth.setValue(self.vars["ext_bar_bar_linewidth"])
        self.bar_title_y.setValue(self.vars["ext_bar_title_y"])
        self.bar_title_font.setText(self.vars["ext_bar_title_fn"])
        self.bar_title_font_size.setValue(self.vars["ext_bar_title_fs"])
        self.bar_threshold.setChecked(self.vars["ext_bar_plot_threshold"])
        self.bar_threshold_colour.setText(self.vars["ext_bar_plot_threshold_color"])
        self.bar_threshold_linewidth.setValue(self.vars["ext_bar_plot_threshold_lw"])
        self.x_tick_rotation.setValue(self.vars["ext_bar_x_ticks_rot"])
        self.x_tick_font_size.setValue(self.vars["ext_bar_y_label_fs"])
        self.x_tick_font.setText(self.vars["ext_bar_x_ticks_fn"])
        self.x_tick_padding.setValue(self.vars["ext_bar_x_ticks_pad"])
        self.y_tick_font_size.setValue(self.vars["ext_bar_y_ticks_fs"])
        self.y_grid_colour.setText(self.vars["ext_bar_y_grid_color"])
        self.markProlines.setChecked(self.vars["ext_bar_mark_prolines"])
        self.proline_marker.setText(self.vars["ext_bar_proline_mark"])
        self.user_details.setChecked(self.vars["ext_bar_mark_user_details"])

    def set_values(self):
        self.accept()
