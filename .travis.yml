# https://pip.pypa.io/en/stable/installing/
language: python
dist: bionic
#python:
#  - "3.6"
#  - "3.7"
#  - "3.8"
#cache: false

#os:
#  - linux
#  - osx
#  - windows

# safelist
branches:
  only:
    - master
    - ciconfig

#env:
  #global:
    #- CC_TEST_REPORTER_ID=
# https://github.com/WeblateOrg/translation-finder/blob/master/.travis.yml#L20-L26

matrix: 
  include:
    - name: "Windows Check Radon Choco"
      os: windows
      language: sh
      python: 3.8
      env: 
        - TOXENV=check,radon
        - PATH=/c/Python38:/c/Python38/Scripts:$PATH
      before_install:
        - choco install python --version=3.8.1
        - pip3 install --upgrade --user pip

    - name: "Windows Check Docs"
      os: windows
      language: sh
      python: 3.8
      env: 
        - TOXENV=docs
        - PATH=/c/Python38:/c/Python38/Scripts:$PATH
      before_install:
        - choco install python --version=3.8.1
        - pip3 install --upgrade --user pip
    
    - name: "Windows Check py38"
      os: windows
      language: sh
      python: 3.8
      env: 
        - TOXENV=py38,codecov
        - PATH=/c/Python38:/c/Python38/Scripts:$PATH
      before_install:
        - choco install python --version=3.8.1
        - pip3 install --upgrade --user pip

    - name: "Windows Check py37"
      os: windows
      language: sh
      python: 3.7
      env:
        - TOXENV=py37,codecov
        - PATH=/c/Python37:/c/Python37/Scripts:$PATH
      before_install:
        - choco install python --version=3.7.6
        - pip3 install --upgrade --user pip

    - name: "Windows Check py36"
      os: windows
      language: sh
      python: 3.6
      env:
        - TOXENV=py36,codecov
        - PATH=/c/Python36:/c/Python36/Scripts:$PATH
      before_install:
        - choco install python --version=3.6.8
        - pip3 install --upgrade --user pip

    - os: linux
      python: 3.8
      env: TOXENV=check,radon
      before_install:
        - python -m pip install --upgrade pip wheel
    - os: linux
      python: 3.8
      env: TOXENV=docs
      before_install:
        - python -m pip install --upgrade pip wheel
    - os: linux
      python: 3.8
      env: TOXENV=py38,codecov
      before_install:
        - python -m pip install --upgrade pip wheel
    - os: linux
      python: 3.7
      env: TOXENV=py37,codecov
      before_install:
        - python -m pip install --upgrade pip wheel
    - os: linux
      python: 3.6
      env: TOXENV=py36,codecov
      before_install:
        - python -m pip install --upgrade pip wheel


    - name: "OSX Check Radon"
      os: osx
      osx_image: xcode11.3
      language: sh
      env:
        TOXENV=check,radon
        #PATH="/usr/local/opt/python@3.8/bin:$PATH"
      before_install:
        #- brew info python
        #- brew switch python 3.8.0
        - python3 -m pip install --upgrade pip wheel
        #- python3 --version
      addons:
        homebrew:
          packages: python


    - name: "OSX DOCS py38 docs"
      os: osx
      osx_image: xcode11.3
      language: sh
      env: TOXENV=docs
      before_install:
        - python3 -m pip install --upgrade pip wheel
        #- brew info python
        #- brew install python@3.8
        #- brew switch python 3.8.0
        #- python3 -m pip install --upgrade pip wheel python==3.8
      addons:
        homebrew:
          packages: python


    - name: "OSX py38 codecov"
      os: osx
      osx_image: xcode11.3
      language: sh
      env: TOXENV=py38,codecov
      before_install:
        #- brew info python
        #- brew unlink python
        #- brew install python@3.8
        #- brew switch python 3.8.0
        # https://stackoverflow.com/questions/59131553/problem-in-installing-and-configuring-latest-python-3-8-on-macos
        - brew install pyenv
        - pyenv init
        - eval "$(pyenv init -)"
        - pyenv install 3.8.0
        - pyenv global 3.8.0
        - python3 -m pip install --upgrade pip wheel
      addons:
        homebrew:
          packages: python

    
    - name: "OSX py37 USING DEFAULT PYTHON"
      os: osx
      osx_image: xcode11.3
      language: sh
      env: TOXENV=py37,codecov
      before_install:
        - python3 -m pip install --upgrade pip wheel


    - name: "OSX py36 codecov"
      os: osx
      osx_image: xcode11.3
      language: sh
      env: TOXENV=py36,codecov
      before_install:
        # https://stackoverflow.com/questions/51125013/how-can-i-install-a-previous-version-of-python-3-in-macos-using-homebrew
        - brew unlink python # ONLY if you have installed (with brew) another version of python 3
        - brew uninstall --ignore-dependencies openssl; brew install https://github.com/tebelorg/Tump/releases/download/v1.0.0/openssl.rb
        - brew install --ignore-dependencies https://raw.githubusercontent.com/Homebrew/homebrew-core/f2a764ef944b1080be64bd88dca9a1d80130c558/Formula/python.rb
        - brew info python
        - brew switch python 3.6.5_1
        - python3 -m pip install --upgrade pip wheel
      addons:
        homebrew:
          packages: python



#before_install:
  #- chmod +x ./cc-test-reporter
  #- ./cc-test-reporter before-build

install:
  #- pip3 install -U pip
  #- python --version
  #- python -m pip --version
 # - if [[ $SENDCOV ]]  
  #- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - pip3 install tox tox-venv
  #- tox --version

script:
  - tox --version
  - tox -v

#after_script:
    #- ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT

after_failure:
  - more .tox/log/* | cat
  - more .tox/*/log/* | cat

notifications:
  email:
    on_success: never
    on_failure: always
